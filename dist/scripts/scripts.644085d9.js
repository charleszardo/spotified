"use strict";var spotified=angular.module("spotifiedApp",["firebase","angular-md5","ui.router","spotify"]);spotified.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("home",{url:"/",templateUrl:"home/home.html",resolve:{requireNoAuth:["$state","AuthService",function(a,b){return b.$requireSignIn().then(function(b){a.go("playlists")},function(a){})}]}}).state("login",{url:"/login",controller:"AuthCtrl as authCtrl",templateUrl:"auth/login.html",resolve:{requireNoAuth:["$state","AuthService",function(a,b){return b.$requireSignIn().then(function(b){a.go("playlists")},function(a){})}]}}).state("register",{url:"/register",controller:"AuthCtrl as authCtrl",templateUrl:"auth/register.html",resolve:{requireNoAuth:["$state","AuthService",function(a,b){return b.$requireSignIn().then(function(b){a.go("playlists")},function(a){})}]}}).state("playlists",{url:"/playlists",controller:"PlaylistsCtrl as playlistsCtrl",templateUrl:"playlists/playlists.html",resolve:{auth:["$state","AuthService",function(a,b){return b.$requireSignIn().catch(function(){a.go("home")})}],userId:["AuthService",function(a){return a.$requireSignIn().then(function(a){return a.uid})}],playlists:["PlaylistsService","AuthService",function(a,b){return b.$requireSignIn().then(function(b){return a.forUser(b.uid).$loaded()})}]}}).state("playlists.playlist",{url:"/{playlistId}",controller:"PlaylistCtrl as playlistCtrl",templateUrl:"playlists/playlist.html",resolve:{playlist:["playlists","$stateParams",function(a,b){return a.$getRecord(b.playlistId)}],songs:["PlaylistService","$stateParams",function(a,b){return a.getSongs(b.playlistId).$loaded()}]}}),b.otherwise("/")}]),spotified.config(function(){var a={apiKey:"AIzaSyBSv9ENuL0m8h7tNqQXZZr8EzpaiWg_udg",authDomain:"spotified-930c5.firebaseapp.com",databaseURL:"https://spotified-930c5.firebaseio.com",storageBucket:"spotified-930c5.appspot.com",messagingSenderId:"358951966806"};firebase.initializeApp(a)}),spotified.constant("FirebaseUrl","https://spotified-930c5.firebaseio.com/ "),spotified.controller("AuthCtrl",["AuthService","$state",function(a,b){var c=this;c.user={email:"",password:""},c.login=function(){a.$signInWithEmailAndPassword(c.user.email,c.user.password).then(function(a){b.go("home")},function(a){c.error=a})},c.register=function(){a.$createUserWithEmailAndPassword(c.user.email,c.user.password).then(function(a){b.go("home")},function(a){c.error=a})}}]),spotified.factory("AuthService",["$firebaseAuth",function(a){var b=a();return b}]),spotified.controller("NavCtrl",["$location","AuthService",function(a,b){var c=this;c.auth=b,c.auth.$onAuthStateChanged(function(a){c.firebaseUser=a}),c.signOut=function(){c.auth.$signOut().then(function(){a.url("/")})}}]),spotified.factory("UsersService",["$firebaseArray","$firebaseObject",function(a,b){var c=firebase.database().ref("users"),d=(a(c),{getUser:function(a){return b(c.child(a))}});return d}]),spotified.factory("PlaylistsService",["$firebaseArray",function(a){var b=firebase.database().ref("playlists"),c={};return c.forUser=function(c){return a(b.child(c))},c.add=function(a){},c}]),spotified.controller("PlaylistsCtrl",["$state","userId","playlists",function(a,b,c){var d=this;d.playlistName="",d.playlists=c,d.addPlaylist=function(){if(""!=d.playlistName){var a={title:d.playlistName,image:null,tracks:[],comments:"",uid:b};d.playlists.$add(a).then(function(){d.playlistName=""})}},d.removePlaylist=function(b){d.playlists.$remove(b).then(function(){a.go("home")})}}]),spotified.factory("PlaylistService",["$firebaseArray",function(a){var b=firebase.database().ref("song"),c={};return c.getSongs=function(c){return a(b.child(c))},c}]),spotified.controller("PlaylistCtrl",["$window","playlist","songs",function(a,b,c){var d=this;d.playlist=b,d.title=b.title,d.songs=c,d.songTitle="",d.export=function(){var b="data:application/json;charset=UTF-8,"+encodeURIComponent(d.playlistJSON());a.open(b)},d.playlistJSON=function(){console.log("OKAY!");var a,b={title:d.title,songs:[]};return angular.forEach(d.songs,function(c){a={track:c.data.title,artist:c.data.artist,album:c.data.album,note:c.data.note,customImage:c.data.customImage},b.songs.push(a)}),JSON.stringify(b)},d.addSong=function(a){var b,c,e=d.songs.length;e>=10||(b={title:a.name,artist:a.artists[0].name,album:a.album.name,note:"",customImage:null},c={data:b,playlistId:d.playlist.$id},d.songs.$add(c).then(function(){d.songTitle=""}))},d.removeSong=function(a){d.songs.$remove(a).then(function(){})},d.getSongs=function(){var a=firebase.database().ref("songs");return $firebaseArray(a.child(playlistId))}}]),spotified.controller("SearchCtrl",["Spotify",function(a){var b=this;b.searchString="",b.results=[],b.searchType="track",b.test="TESTIN!",b.search=function(){"artist"===b.searchType?b.artistSearch():"album"===b.searchType?b.albumSearch():b.trackSearch()},b.trackSearch=function(){a.search(b.searchString,"track").then(function(a){b.results=a.tracks.items})},b.artistSearch=function(){a.search(b.searchString,"artist").then(function(c){angular.forEach(c.artists.items,function(c){a.getArtistTopTracks(c.id,"US").then(function(a){b.results=b.results.concat(a.tracks)})})})},b.albumSearch=function(){b.results=[],a.search(b.searchString,"album").then(function(c){angular.forEach(c.albums.items,function(c){a.getAlbumTracks(c.id).then(function(a){console.log(a),b.results=b.results.concat(a.items)})})})}}]),spotified.directive("search",function(){return{restrict:"E",controller:"SearchCtrl as searchCtrl",templateUrl:"/search/search.html"}}),spotified.controller("SongCtrl",function(){var a=this;a.parseArtists=function(a){var b=a.map(function(a){return a.name});return b.join(", ")}}),spotified.directive("song",function(){return{restrict:"E",scope:{obj:"="},link:function(a){console.log(a.obj)},controller:"SongCtrl as songCtrl",templateUrl:"/songs/song.html"}});